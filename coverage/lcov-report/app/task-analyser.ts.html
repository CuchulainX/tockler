<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for app/task-analyser.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">All files</a> / <a href="index.html">app</a> task-analyser.ts
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">17.86% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>25/140</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">8.42% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>8/95</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">11.11% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>3/27</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">24.27% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>25/103</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-no">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">'use strict';
import { TrackItemInstance } from './models/<span class="fstat-no" title="function not covered" >in</span>terfaces/track-item-interface';
impo<span class="cstat-no" title="statement not covered" >rt { settingsService } from './s<span class="fstat-no" title="function not covered" >er</span>vices/settings-service';</span>
import { trackIte<span class="fstat-no" title="function not covered" >mService }</span> from './<span class="cstat-no" title="statement not covered" >servic<span class="cstat-no" title="statement not covered" >es/track-item-service';<span class="cstat-no" title="statement not covered" ></span></span></span>
import { appSetti<span class="fstat-no" title="function not covered" >ngService</span> } from '<span class="cstat-no" title="statement not covered" >./serv<span class="cstat-no" title="statement not covered" >ices/app-setting-service';<span class="cstat-no" title="statement not covered" ></span></span></span>
<span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" ><span class="fstat-no" title="function not covered" ></span></span></span></span>
import *<span class="cstat-no" title="statement not covered" > as notifier from "node-notifier";</span>
&nbsp;
const config = require('./config');
const path = require('path');<span class="fstat-no" title="function not covered" ></span>
const $q = r<span class="cstat-no" title="statement not covered" >equire('q');<span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" ></span></span></span></span></span>
cons<span class="cstat-no" title="statement not covered" >t moment = require('moment');</span>
const iconUrl<span class="fstat-no" title="function not covered" > = co</span>nfig.<span class="cstat-no" title="statement not covered" >icon;<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" ></span></span></span>
<span class="fstat-no" title="function not covered" ></span>
notifier<span class="cstat-no" title="statement not covered" >.on('cl<span class="cstat-no" title="statement not covered" >ick', function (notifierObject, options) {</span></span>
    if (<span class="cstat-no" title="statement not covered" >TaskAnalys<span class="cstat-no" title="statement not covered" >er.newItem == null) {</span></span>
        cons<span class="cstat-no" title="statement not covered" >ole.log("Already clicked. Prevent from creating double item.");<span class="cstat-no" title="statement not covered" ></span></span>
        retu<span class="cstat-no" title="statement not covered" >rn;<span class="cstat-no" title="statement not covered" ></span></span>
    }<span class="cstat-no" title="statement not covered" ></span>
    console.log("Clicked. Creati<span class="cstat-no" title="statement not covered" >ng new t<span class="cstat-no" title="statement not covered" ></span>ask", T</span>askAnalyser.newItem);
    appSettingService.ge<span class="cstat-no" title="statement not covered" >tAppColor(T<span class="cstat-no" title="statement not covered" ></span>askAnalyser.newItem.app).then((color) </span>=&gt; {
        TaskAnalyser.new<span class="cstat-no" title="statement not covered" >Item.color <span class="cstat-no" title="statement not covered" ></span>= color;<span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" ></span></span></span>
        //TODO: refactor<span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" ></span></span></span>
        trackItemService.createTrackItem(TaskAnalyser.newItem).then((trackItem: any) =&gt; {
            console.<span class="cstat-no" title="statement not covered" >log("Created new task, saving reference: ", trackItem.id);<span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" ></span></span></span>
            TaskAnal<span class="cstat-no" title="statement not covered" >yser.newItem = null;<span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" ></span></span></span>
<span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" ></span></span></span></span>
            notifier<span class="cstat-no" title="statement not covered" >.notify({<span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" ></span></span></span></span>
                titl<span class="cstat-no" title="statement not covered" >e: 'New ta<span class="cstat-no" title="statement not covered" >sk created!',</span></span>
                mess<span class="cstat-no" title="statement not covered" >age: `Task "${<span class="cstat-no" title="statement not covered" ></span>trackItem.</span>title}" running.`,
                icon: iconUrl,
<span class="cstat-no" title="statement not covered" >                sound: true, // Only Not</span>ification Center or Windows Toasters
                wait: <span class="cstat-no" title="statement not covered" >false // Wait<span class="cstat-no" title="statement not covered" ></span> with c</span>allback, unt<span class="cstat-no" title="statement not covered" >il user act</span>ion is taken against notification
<span class="cstat-no" title="statement not covered" >            });<span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" ></span></span></span>
&nbsp;
            settingsService.saveRunningLogItemReference(trackItem.id);
        });
    });
});
&nbsp;
export default class TaskAnalyser {
&nbsp;
    static _newItem;
&nbsp;
    static get newItem() {
        return TaskAnalyser._newItem;
    }<span class="fstat-no" title="function not covered" ></span>
<span class="cstat-no" title="statement not covered" ></span>
    stat<span class="cstat-no" title="statement not covered" >ic set newItem(tempNewItem) {</span>
<span class="cstat-no" title="statement not covered" >        TaskAnal</span>yser._newItem = tempNewItem;
    }
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >    static findFirst(str, findRe) {<span class="fstat-no" title="function not covered" ></span></span>
<span class="cstat-no" title="statement not covered" >        if (!findRe) {</span>
            return;
<span class="cstat-no" title="statement not covered" >        }<span class="fstat-no" title="function not covered" ></span></span>
        var <span class="cstat-no" title="statement not covered" >re = new RegExp(findRe, "g");</span>
        var <span class="cstat-no" title="statement not covered" >result = re.exec(str);</span>
<span class="cstat-no" title="statement not covered" ></span>
        if (result != null) {
            let first = result[0];
            return first;
        }
    }
&nbsp;
    static a<span class="cstat-no" title="statement not covered" >nalyseAndNotify(item) {</span>
&nbsp;
        if (item.taskName !== 'AppTrackItem') {
            return;
        }
<span class="fstat-no" title="function not covered" ></span>
        settingsService.fetchAnalyserSettings().then((analyserItems: any) =&gt; {
            for (let patObj of analyserItems) {
<span class="fstat-no" title="function not covered" ></span>                if (!patObj.findRe || !patObj.active) {
<span class="cstat-no" title="statement not covered" >                    continue;</span>
                }
<span class="fstat-no" title="function not covered" ></span>
<span class="cstat-no" title="statement not covered" >                let foundStr = TaskAnalyser.findF</span>irst(item.title, patObj.findRe);
&nbsp;
                if (!foundStr) {
                    continue;
                }
<span class="fstat-no" title="function not covered" ></span>
<span class="cstat-no" title="statement not covered" >                let title = TaskAnalyser.findFirst(item.title, patObj.takeTitle) || item.title;</span>
<span class="cstat-no" title="statement not covered" >                let </span>app = TaskAnalyser.findFirst(item.title, patObj.takeGroup) || foundStr;
&nbsp;
                s<span class="cstat-no" title="statement not covered" >ettingsService.getRunnin</span>gLogItem().then((runningItem: TrackItemInstance) =&gt; {
                    i<span class="cstat-no" title="statement not covered" >f (runningIte</span>m &amp;&amp; runningItem.title === title &amp;&amp; runningItem.app == app) {
<span class="cstat-no" title="statement not covered" >                        console.log("Same item, not notifying to create new item.");</span>
<span class="cstat-no" title="statement not covered" >                        return;</span>
<span class="cstat-no" title="statement not covered" >                    }</span>
                    TaskAnalyser.newItem = {
                        app: app,
                        title: title,
                        taskName: 'LogTrackItem',
                        beginDate: new Date(),
                        endDate: new Date()
                    };
<span class="fstat-no" title="function not covered" ></span>
<span class="cstat-no" title="statement not covered" >                    notifier.notify({</span>
<span class="cstat-no" title="statement not covered" >                        title: 'Create </span>new task?',
                        message: `Click to create: "${app}"`,
                        icon: i<span class="cstat-no" title="statement not covered" >conUrl,</span>
<span class="cstat-no" title="statement not covered" >                        sound: true, // Only Notification Center or Windows Toasters</span>
<span class="cstat-no" title="statement not covered" >                        wait: true // W</span>ait with callback, until user action is taken against notification
                    }, function (err, response) {
                        // R<span class="cstat-no" title="statement not covered" >esponse is response from notification</span>
                    });<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >                });<span class="fstat-no" title="function not covered" ></span></span>
            }<span class="cstat-no" title="statement not covered" ></span>
        });<span class="cstat-no" title="statement not covered" ></span>
    }<span class="cstat-no" title="statement not covered" ></span>
&nbsp;
    static async get<span class="cstat-no" title="statement not covered" >TaskSplitDate() {</span>
        let onlineItems = await trackItemService.findLastOnlineItem();
        if (onlineItems &amp;&amp; onlineItems.length &gt; 0) {
            let settings = await settingsService.fetchWorkSettings();
&nbsp;
            var onlineItem = onlineItems[0];
            var minutesAfterToSplit = settings.splitTaskAfterIdlingForMinutes || 3;
            var minu<span class="cstat-no" title="statement not covered" >tesFromNow = moment().diff(onlineItem.endDate, 'minutes');</span>
&nbsp;
            console.log("Minutes from now:" + minutesFromNow);
&nbsp;
            if (minutesFromNow &gt;= minutesAfterToSplit) {
                let endDate = moment(onlineItem.endDate).add(minutesAfterToSplit, 'minutes').toDate();
                return <span class="fstat-no" title="function not covered" >en</span>dDate;
            }
        } 
&nbsp;
        return null;
    }
}<span class="cstat-no" title="statement not covered" ></span></pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Sat Jul 01 2017 12:02:55 GMT+0300 (EEST)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
